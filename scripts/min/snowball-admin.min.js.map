{"version":3,"sources":["snowball-admin.js"],"names":["$","setHandlers","on","props","status","this","attr","logger","changesMade","debounce","snowball","title","val","each","trigger","type","data","addBlock","actions","push","action","tag","removeClass","addClass","show","hide","filter","form","hasClass","find","text","toggle","mood","comment","fb","css","parent","width","fixedsticky","block","renderPreview","height","closest","refreshEditors","confirmDelete","copyBlock","toggleClass","zoomPreview","index","editor","CodeMirror","refresh","length","initEditors","sortable","axis","containment","cancel","cursor","tolerance","click","e","keyCode","window","resize","populateSavedBlocks","b","savedblocks","toLowerCase","at","blockCode","blocks","name","names","end","append","key","hasOwnProperty","selector","input","value","is","prop","customCss","html","dataBlock","blockType","load","wpColorPicker","change","event","appendTo","insertAfter","eq","preview","contents","templates","fields","element","target","replace","regex","RegExp","author","blogname","blogurl","date","url","$html","blockScripts","detach","empty","previewScripts","callback","i","script","iframe","get","contentDocument","createElement","src","defaultScripts","onload","callback2","head","appendChild","innerHTML","body","style","cm","defaultCss","pluginsUrl","includesUrl","cssEditor","retrieveNonReadOnlyText","customStyle","data-type","scoped","defaultStylesheets","forEach","href","code","zoom","scale","-webkit-transform","transform","editors","elem","modeType","isReadOnly","fromTextArea","mode","htmlMode","readOnly","lineNumbers","lineWrapping","indentUnit","tabSize","theme","renderEditor","cssCode","split","nonReadOnlyCode","clone","remove","cursorPos","getCursor","scrollPos","getScrollInfo","top","startLine","line","ch","endLine","options","inclusiveLeft","setValue","markText","addLineClass","setCursor","scrollTo","readOnlyMark","getAllMarks","getValue","mark","lastReadOnlyLine","lines","fromLine","toLine","lastLine","getRange","parseBlock","htmlEditor","result","confirm","fn","delay","timer","context","args","arguments","clearTimeout","setTimeout","apply","article","Parse","initialize","Blocks","Object","extend","set","id","save","Feedback","feedback","jQuery","document","ready","JSON","parse"],"mappings":"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","file":"snowball-admin.min.js","sourcesContent":["(function($) {\r\n  var changesMade = false;\r\n  var actions = [];\r\n\r\n  jQuery(document).ready(function() {\r\n\r\n    setHandlers();\r\n\r\n    if ((snowball.savedblocks.length !== 0) && (snowball.savedblocks !== \"null\")) {\r\n      snowball.savedblocks = JSON.parse(snowball.savedblocks);\r\n      populateSavedBlocks();\r\n    } else {\r\n      snowball.savedblocks = [];\r\n    }\r\n  });\r\n\r\n  function setHandlers() {\r\n    $(\"#publish, #save-post\").on(\"click\", function() {\r\n      var props = {};\r\n\r\n      if ($(this).attr(\"id\") == \"publish\") {\r\n        props.status = \"publish\";\r\n      } else {\r\n        props.status = \"draft\";\r\n      }\r\n\r\n      logger(props);\r\n\r\n      changesMade = false;\r\n    });\r\n\r\n    $(\"#title\").on(\"input\", debounce(function() {\r\n      snowball.title = $(this).val();\r\n      $(\".snowball-block\").each(function() {\r\n        $(this).trigger(\"render\");\r\n      });\r\n    }, 250));\r\n\r\n    $(\"#snowball-toolbar\")\r\n      .on(\"click\", \".block-button\", function() {\r\n        var type = $(this).data(\"type\");\r\n        addBlock(type);\r\n        changesMade = true;\r\n\r\n        actions.push({\r\n          action: \"add\",\r\n          type: type\r\n        });\r\n\r\n      })\r\n      .on(\"click\", \".tag\", function() {\r\n        var tag = $(this).attr(\"data-tag\");\r\n        $(\".tag.active\").removeClass(\"active\");\r\n        $(this).addClass(\"active\");\r\n\r\n        if (tag === \"all\") {\r\n          $(\"#snowball-toolbar .button\").show();\r\n        } else {\r\n          $(\"#snowball-toolbar .button\").hide().filter(\".\" + tag).show();\r\n        }\r\n      })\r\n      .on(\"click\", \".feedback\", function() {\r\n        var form = $(\"#feedback-form\");\r\n\r\n        if ($(this).hasClass(\"happy\")) {\r\n          form.data(\"mood\", \"positive\");\r\n          form.find(\".header\").text(\"How did Snowball make you happy?\");\r\n        } else {\r\n          form.data(\"mood\", \"negative\");\r\n          form.find(\".header\").text(\"How did Snowball make you sad, frustrated, or annoyed?\");\r\n        }\r\n\r\n        form.toggle();\r\n      })\r\n      .on(\"click\", \"#feedback-form .close\", function() {\r\n        $(\"#feedback-form\").hide();\r\n      })\r\n      .on(\"click\", \"#feedback-form .button\", function() {\r\n        var form = $(\"#feedback-form\");\r\n        var mood = form.data(\"mood\");\r\n        var comment = form.find(\"textarea\").val();\r\n\r\n        fb(mood, comment);\r\n\r\n        form.hide();\r\n        form.find(\"textarea\").val(\"\");\r\n      })\r\n      .css(\"width\", $(\"#snowball-toolbar\").parent().width())\r\n      .fixedsticky();\r\n\r\n    $(\"#snowball-main\")\r\n      .on(\"render\", \".snowball-block\", function() {\r\n        var block = $(this);\r\n        renderPreview(block);\r\n      })\r\n      .on(\"mousedown\", \".snowball-block\", function() {\r\n        $(\"#snowball-main\").height($(\"#snowball-main\").height());\r\n      })\r\n      .on(\"mouseup\", \".snowball-block\", function() {\r\n        $(\"#snowball-main\").height(\"auto\");\r\n      })\r\n      .on(\"input change paste\", \".snowball-tinker input, .snowball-tinker textarea:not(.handsontableInput), .snowball-tinker select\", debounce(function() {\r\n        var block = $(this).closest(\".snowball-block\");\r\n        block.trigger(\"render\");\r\n        refreshEditors(block);\r\n        changesMade = true;\r\n      }, 250))\r\n      .on(\"click\", \".snowball-delete\", function() {\r\n        var block = $(this).closest(\".snowball-block\");\r\n        var type = block.data(\"type\");\r\n\r\n        confirmDelete(block);\r\n      })\r\n      .on(\"click\", \".snowball-copy\", function() {\r\n        var block = $(this).closest(\".snowball-block\");\r\n        var type = block.data(\"type\");\r\n\r\n        copyBlock(block);\r\n\r\n        actions.push({\r\n          action: \"copy\",\r\n          type: type\r\n        });\r\n      })\r\n      .on(\"click\", \".snowball-zoom-toggle\", function() {\r\n        var block = $(this).closest(\".snowball-block\");\r\n        var type = block.data(\"type\");\r\n\r\n        block.find(\".snowball-code, .snowball-copy, .snowball-delete\").toggle();\r\n\r\n        block.toggleClass(\"modal\");\r\n        $(\"body\").toggleClass(\"modal\");\r\n        zoomPreview(block);\r\n\r\n        actions.push({\r\n          action: \"code\",\r\n          type: type\r\n        });\r\n\r\n        block.find(\".CodeMirror\").each(function(index, editor) {\r\n          editor.CodeMirror.refresh();\r\n        });\r\n      })\r\n      .on(\"mouseover\", \".snowball-zoom-toggle\", function() {\r\n        var block = $(this).closest(\".snowball-block\");\r\n\r\n        if (block.find(\".snowball-code .CodeMirror\").length === 0) {\r\n          initEditors(block);\r\n        }\r\n      })\r\n      .sortable({\r\n        \"axis\": \"y\",\r\n        \"containment\": \"#snowball-main\",\r\n        \"cancel\": \".snowball-block.modal, textarea, input, select, .handsontable .wtHider, .CodeMirror, .toggle-buttons\",\r\n        \"cursor\": \"move\",\r\n        \"tolerance\": \"pointer\"\r\n      });\r\n\r\n    $(\"body\")\r\n      .on(\"click\", \"#modal-bg\", function() {\r\n        $(\".snowball-block.modal .snowball-zoom-toggle\").click();\r\n      })\r\n      .on(\"keydown\", function (e) {\r\n        if (e.keyCode === 27) { // ESC\r\n          $(\".snowball-block.modal .snowball-zoom-toggle\").click();\r\n        }\r\n      });\r\n\r\n    $(\"#adminmenuback\").on(\"mouseenter\", function() {\r\n      $(\"body\").addClass(\"show-menu\");\r\n    });\r\n\r\n    $(\"#adminmenuwrap\").on(\"mouseleave\", function() {\r\n      $(\"body\").removeClass(\"show-menu\");\r\n    });\r\n\r\n    $(\"#wpwrap\").on(\"click\", function() {\r\n      $(\"body\").removeClass(\"show-menu\");\r\n    });\r\n\r\n    $(window)\r\n      .resize(debounce(function() {\r\n        zoomPreview();\r\n      }, 250))\r\n      .resize(function() {\r\n        var fixedsticky = $(\".fixedsticky\");\r\n        fixedsticky.css(\"width\", fixedsticky.parent().width());\r\n      })\r\n      .on(\"beforeunload\", function(e) {\r\n        if (changesMade) {\r\n          return \"You may have unsaved changes.\";\r\n        }\r\n      });\r\n\r\n    $(\"#collapse-menu\").click(function() {\r\n      var fixedsticky = $(\".fixedsticky\");\r\n      fixedsticky.css(\"width\", fixedsticky.parent().width());\r\n      zoomPreview();\r\n    });\r\n  }\r\n\r\n  function populateSavedBlocks() {\r\n    for (var b in snowball.savedblocks) {\r\n      var block = snowball.savedblocks[b];\r\n      var type = block[\"blockType\"].toLowerCase();\r\n      // need to delete so snowball.addBlock works properly\r\n      delete block[\"blockType\"];\r\n      delete block[\"orderNumber\"];\r\n\r\n      addBlock(type, block);\r\n    }\r\n  }\r\n\r\n  function addBlock(type, data, at) {\r\n    var blockCode = snowball.blocks[type];\r\n    var name = snowball.names[type];\r\n    var block = $(\"<div class='snowball-block'>\" +\r\n                    \"<div class='snowball-gui'>\" +\r\n                      \"<div class='snowball-tinker'>\" +\r\n                        \"<div>\" +\r\n                          \"<div class='snowball-title'></div>\" +\r\n                          \"<div class='snowball-title-button snowball-delete'>&times;</div>\" +\r\n                          \"<div class='snowball-title-button snowball-copy'><i class='fa fa-files-o'></i></div>\" +\r\n                          \"<div class='snowball-title-button snowball-zoom-toggle'><i class='fa fa-code'></i></div>\" +\r\n                        \"</div>\" +\r\n                      \"</div>\" +\r\n                      \"<iframe class='snowball-preview'></iframe>\" +\r\n                    \"</div>\" +\r\n                    \"<div class='snowball-code'>\" +\r\n                      \"<div class='snowball-html snowball-editor'>\" +\r\n                        \"<div class='snowball-code-title'>HTML</div>\" +\r\n                        \"<textarea class='snowball-editor-box' data-mode='xml'></textarea>\" +\r\n                      \"</div>\" +\r\n                      \"<div class='snowball-css snowball-editor'>\" +\r\n                        \"<div class='snowball-code-title'>CSS</div>\" +\r\n                        \"<textarea class='snowball-editor-box' data-mode='css'></textarea>\" +\r\n                      \"</div>\" +\r\n                    \"</div>\" +\r\n                  \"</div>\");\r\n\r\n    block\r\n      .addClass(\"snowball-block-\" + type)\r\n      .attr(\"data-type\", type)\r\n      .attr(\"data-name\", name)\r\n      .find(\".snowball-title\").text(name).end()\r\n      .find(\".snowball-tinker\").append(blockCode).end();\r\n\r\n    if (data) {\r\n      for (var key in data) {\r\n        if (data.hasOwnProperty(key)) {\r\n          var selector = \"[data-target='\" + key + \"']\";\r\n          var input = block.find(selector);\r\n          var value = data[key];\r\n          if (input) {\r\n            if (input.is(\":radio\")) {\r\n              input.filter(\"[value='\" +  value + \"']\").prop(\"checked\", true);\r\n            } else if (input.is(\":checkbox\")) {\r\n              input.prop(\"checked\", (value == \"true\"));\r\n            } else {\r\n              input.val(value);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (data.customCss) {\r\n          block.find(\"textarea[data-mode='css']\").html(data.customCss);\r\n        }\r\n      }\r\n\r\n\r\n    } else {\r\n      var dataBlock = {\r\n        blockType: type\r\n      };\r\n\r\n      snowball.savedblocks.push(dataBlock);\r\n    }\r\n\r\n    block\r\n      .find(\".snowball-preview\").load(function() {\r\n        renderPreview(block);\r\n      }).end()\r\n      .find(\".wp-color-picker\").wpColorPicker({\r\n        change: debounce(function (event) {\r\n          $(this)\r\n            .trigger(\"change\")\r\n            .attr(\"value\", $(this).val());\r\n        }, 250)\r\n      });\r\n\r\n    if (typeof at == \"undefined\") {\r\n      block.appendTo(\"#snowball-main\");\r\n    } else {\r\n      block.insertAfter($(\".snowball-block\").eq(at));\r\n    }\r\n    \r\n    block.trigger(\"open\");\r\n  }\r\n\r\n  function renderPreview(block) {\r\n    var type = block.data(\"type\");\r\n    var preview = block.find(\".snowball-preview\").contents();\r\n    var html = snowball.templates[type];\r\n    var selector = \"input[type='text'][data-target], input[type='email'][data-target], input[type='range'][data-target], input[type='hidden'][data-target], input[type='radio'][data-target]:checked, input[type='checkbox'][data-target]:checked, textarea[data-target], select[data-target]\";\r\n    var fields = block.find(selector);\r\n\r\n    fields.each(function(index, element) {\r\n      var target = $(this).data(\"target\");\r\n      var value = $(this).val();\r\n\r\n      if ((type === \"text\") && $(this).is(\"textarea\")) {\r\n        // For text blocks, replace \\n\\n with <p>\r\n        value = value.replace(/(.+?)\\n{2,}/g,'<p>$1</p>');\r\n      }\r\n      var regex = new RegExp(\"{{\" + target + \"}}\", \"g\");\r\n      html = html.replace(regex, value);\r\n    });\r\n\r\n    html = html.replace(/{{.+}}/g, \"\");\r\n\r\n    html = html.replace(/\\[author\\]/g, snowball.author)\r\n               .replace(/\\[blogname\\]/g, snowball.blogname)\r\n               .replace(/\\[blogurl\\]/g, snowball.blogurl)\r\n               .replace(/\\[date\\]/g, snowball.date)\r\n               .replace(/\\[url\\]/g, snowball.url);\r\n\r\n    if (snowball.title) {\r\n      html = html.replace(/\\[title\\]/g, snowball.title);\r\n    }\r\n\r\n    var $html = $(html);\r\n    var blockScripts = $html.find(\"script\").detach();\r\n\r\n    preview.find(\"body\").empty().append($html);\r\n    previewScripts(blockScripts, block);\r\n\r\n    if (block.width()) {\r\n      zoomPreview(block);\r\n    }\r\n\r\n    block.trigger(\"rendered\");\r\n  }\r\n\r\n  // create script elements from iframe document so js is executed in iframe's context\r\n  // append default scripts to head so they aren't repeated in article for each block\r\n  // append block scripts to body so they are included in article\r\n  // only block scripts with src are re-appended here\r\n  // block scripts with innerhtml must be evaled in snowball-preview.js\r\n\r\n  function previewScripts(blockScripts, block) {\r\n    var iframe = block.find(\".snowball-preview\");\r\n    var preview = iframe.contents();\r\n    var head = preview.find(\"head\");\r\n    var body = preview.find(\"body\");\r\n    var cm = block.find('.snowball-code .CodeMirror');\r\n    var defaultCss = \"\";\r\n\r\n    var pluginsUrl = snowball.pluginsUrl;\r\n    var includesUrl = snowball.includesUrl;\r\n\r\n    var style;\r\n\r\n    if (cm.length) {\r\n      var cssEditor = cm[1].CodeMirror;\r\n      style = retrieveNonReadOnlyText(cssEditor);\r\n    } else {\r\n      style = block.find(\"textarea[data-mode='css']\").html();\r\n    }\r\n\r\n    if (style) {\r\n      var customStyle = $(\"<style></style>\").attr({\"data-type\": \"custom\", \"scoped\": \"scoped\"});\r\n      customStyle.html(style);\r\n      body.find(\".snowball-block\").append(customStyle);\r\n    }\r\n\r\n    var defaultStylesheets = [\r\n                                pluginsUrl + \"/lib/d3-geomap/css/d3.geomap.css\",\r\n                                pluginsUrl + \"/lib/font-awesome/css/font-awesome.min.css\",\r\n                                pluginsUrl + \"/styles/min/snowball.min.css\",\r\n                                pluginsUrl + \"/styles/min/snowball-preview.min.css\"\r\n                              ];\r\n\r\n    var defaultScripts = [\r\n                            includesUrl + \"js/jquery/jquery.js\",\r\n                            \"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js\",\r\n                            \"https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js\",\r\n                            pluginsUrl + \"/lib/d3-geomap/vendor/d3.geomap.dependencies.min.js\",\r\n                            pluginsUrl + \"/lib/d3-geomap/js/d3.geomap.min.js\",\r\n                            pluginsUrl + \"/scripts/min/snowball-preview.min.js\",\r\n                            pluginsUrl + \"/scripts/min/templates.min.js\"\r\n                          ];\r\n\r\n    defaultStylesheets.forEach(function(href) {\r\n      var code = \"<link rel='stylesheet' href='\" + href + \"'>\\n\";\r\n      defaultCss = defaultCss + code;\r\n    });\r\n\r\n    if(head.is(\":empty\")) {\r\n      head.html(\"<meta charset='utf-8'>\");\r\n      head.append(defaultCss);\r\n      callback(0);\r\n    } else {\r\n      callback2(0);\r\n    }\r\n\r\n    function callback(i) {\r\n      var script = iframe.get(0).contentDocument.createElement(\"script\");\r\n      script.src = defaultScripts[i];\r\n\r\n      if (i < defaultScripts.length - 1) {\r\n        script.onload = function() {\r\n          callback(i+1);\r\n        };\r\n      } else {\r\n        script.onload = function() {\r\n          callback2(0);\r\n        };\r\n      }\r\n\r\n      head[0].appendChild(script);\r\n    }\r\n\r\n    function callback2(i) {\r\n      if (i < blockScripts.length) {\r\n        var src = blockScripts.eq(i).attr(\"src\");\r\n        var script = iframe.get(0).contentDocument.createElement(\"script\");\r\n\r\n        if (src) {\r\n          script.src = src;\r\n          script.onload = function() {\r\n            callback2(i+1);\r\n          };\r\n        } else {\r\n          script.innerHTML = blockScripts.eq(i).html();\r\n        }\r\n\r\n        body.find(\".snowball-block\").get(0).appendChild(script);\r\n      }\r\n    }\r\n  }\r\n\r\n  function zoomPreview(block) {\r\n    var width;\r\n    var zoom;\r\n    var scale;\r\n\r\n    if (block) {\r\n      width = block.width() / 2;\r\n      zoom = (width < 800) ? width/800 : 1;\r\n      scale = \"scale(\" + zoom + \")\";\r\n\r\n      block.find(\".snowball-preview\").contents().find(\"html\").css({\"-webkit-transform\": scale, \"transform\": scale});\r\n    } else {\r\n      $(\".snowball-preview\").each(function() {\r\n        width = $(this).closest(\".snowball-block\").width() / 2;\r\n        zoom = (width < 800) ? width/800 : 1;\r\n        scale = \"scale(\" + zoom + \")\";\r\n\r\n        $(this).contents().find(\"html\").css({\"-webkit-transform\": scale, \"transform\": scale});\r\n      });\r\n    }\r\n  }\r\n\r\n  function initEditors(block) {\r\n    var preview = block.find(\".snowball-preview\").contents().find(\"body\");\r\n    var editors = block.find(\".snowball-editor-box\");\r\n\r\n    editors.each(function(index, elem) {\r\n      var modeType = $(elem).attr(\"data-mode\");\r\n      var isReadOnly = (modeType === \"xml\") ? true : false;\r\n\r\n      var editor = CodeMirror.fromTextArea(elem, {\r\n          mode: {name: modeType, htmlMode: true},\r\n          readOnly: isReadOnly,\r\n          lineNumbers: true,\r\n          lineWrapping: true,\r\n          indentUnit: 2,\r\n          tabSize: 2,\r\n          theme: \"monokai\"\r\n      });\r\n\r\n      renderEditor(preview, modeType, editor);\r\n\r\n      editor.on(\"change\", debounce(function() {\r\n        var block = $(elem).closest(\".snowball-block\");\r\n        renderPreview(block);\r\n        changesMade = true;\r\n      }, 250));\r\n\r\n    });\r\n  }\r\n\r\n  function renderEditor(preview, modeType, editor, cssCode) {\r\n    var code = \"\";\r\n    var length = 0;\r\n    if (modeType == \"css\") {\r\n      preview.find(\"style:not([data-type='custom'])\").each(function() {\r\n        code = code + $(this).html();\r\n      });\r\n      // code = preview.find(\"style:not([data-type='custom'])\").html();\r\n\r\n      if (code) {\r\n        code = code.replace(/^\\n+|\\n+$/g, '');\r\n        code = code + \"\\n\\n\";\r\n        length = code.split(/\\r\\n|\\r|\\n/).length - 1;\r\n      } else {\r\n        code = \"\";\r\n      }\r\n\r\n      if (cssCode) {\r\n        code = code + cssCode;\r\n      }\r\n\r\n      var nonReadOnlyCode = retrieveNonReadOnlyText(editor);\r\n      if (nonReadOnlyCode) {\r\n        code = code + nonReadOnlyCode;\r\n      }\r\n    } else if (modeType === \"xml\") {\r\n      var clone = preview.clone();\r\n      clone.find(\"style\").remove();\r\n      code = clone.html().replace(\"\\n\\n</section>\", \"\\n</section>\");\r\n      length = code.split(/\\r\\n|\\r|\\n/).length;\r\n    }\r\n\r\n    var cursorPos = editor.getCursor();\r\n    var scrollPos = editor.getScrollInfo().top;\r\n    var startLine = {line: 0, ch: 0};\r\n    var endLine = {line: length, ch: 0};\r\n    var options = {readOnly: true, inclusiveLeft: true};\r\n\r\n    editor.setValue(code);\r\n    editor.markText(startLine, endLine, options);\r\n\r\n    for (var i = 0; i < length; i++) {\r\n      editor.addLineClass(i, \"background\", \"readonly\");\r\n    }\r\n\r\n    editor.setCursor(cursorPos);\r\n    editor.scrollTo(null, scrollPos);\r\n  }\r\n\r\n  function retrieveNonReadOnlyText(editor) {\r\n    // there should only be one marked text object in editor.getAllMarks()\r\n    var readOnlyMark = editor.getAllMarks();\r\n    var code = editor.getValue();\r\n\r\n    if (readOnlyMark.length) {\r\n      var mark = readOnlyMark[0];\r\n      var lastReadOnlyLine = mark.lines.length;\r\n\r\n      if (lastReadOnlyLine < 2) {\r\n        code = editor.getValue();\r\n      } else {\r\n        var fromLine = {line:lastReadOnlyLine-1, ch:0};\r\n        var toLine = {line:editor.lastLine()+1, ch:0};\r\n        code = editor.getRange(fromLine, toLine);\r\n      }\r\n    }\r\n\r\n    return code;\r\n  }\r\n\r\n  function copyBlock(block) {\r\n    var type = block.data(\"type\");\r\n    var data = parseBlock(block);\r\n    var index = block.index();\r\n\r\n    if (data) {\r\n      addBlock(type, data, index);\r\n    }\r\n  }\r\n\r\n  function refreshEditors(block) {\r\n    var cm = block.find('.snowball-code .CodeMirror');\r\n\r\n    if (cm.length) {\r\n      var htmlEditor = cm[0].CodeMirror;\r\n      var cssEditor = cm[1].CodeMirror;\r\n      var preview = block.find(\".snowball-preview\").contents().find(\"body\");\r\n      renderEditor(preview, \"xml\", htmlEditor);\r\n      renderEditor(preview, \"css\", cssEditor);\r\n    }\r\n  }\r\n\r\n  function confirmDelete(block) {\r\n    var result = confirm(\"Are you sure you want to delete this block?\");\r\n    if (result) {\r\n      block\r\n        .trigger(\"close\")\r\n        .remove();\r\n\r\n      changesMade = true;\r\n\r\n      actions.push({\r\n        action: \"delete\",\r\n        type: type\r\n      });\r\n    }\r\n  }\r\n\r\n  function debounce(fn, delay) {\r\n    var timer = null;\r\n    return function () {\r\n      var context = this, args = arguments;\r\n      clearTimeout(timer);\r\n      timer = setTimeout(function () {\r\n        fn.apply(context, args);\r\n      }, delay);\r\n    };\r\n  }\r\n\r\n  function logger(props) {\r\n    var article = [];\r\n\r\n    $(\".snowball-block\").each(function() {\r\n      var type = $(this).data(\"type\");\r\n      article.push(type);\r\n    });\r\n\r\n    Parse.initialize(\"FwVMmzHookZZ5j9F9ILc2E5MT5ufabuV7hCXKSeu\",\"Q069j2TUEegDfQJXxxYp7OIZrgu7ySYcqmSU05pQ\");\r\n    var Blocks = Parse.Object.extend(\"Blocks\");\r\n    var blocks = new Blocks();\r\n    blocks.set('blogname', snowball.blogname);\r\n    blocks.set('blogurl', snowball.blogurl);\r\n    blocks.set('url', snowball.url);\r\n    blocks.set('postid', snowball.id);\r\n    blocks.set('status', props.status);\r\n    blocks.set('author', snowball.author);\r\n    blocks.set('article', article);\r\n    blocks.set('size', article.length);\r\n    blocks.set('actions', actions);\r\n    blocks.save();\r\n\r\n    actions = [];\r\n  }\r\n\r\n  function fb(mood, comment) {\r\n    Parse.initialize(\"FwVMmzHookZZ5j9F9ILc2E5MT5ufabuV7hCXKSeu\",\"Q069j2TUEegDfQJXxxYp7OIZrgu7ySYcqmSU05pQ\");\r\n    var Feedback = Parse.Object.extend(\"Feedback\");\r\n    var feedback = new Feedback();\r\n    feedback.set('blogname', snowball.blogname);\r\n    feedback.set('blogurl', snowball.blogurl);\r\n    feedback.set('url', snowball.url);\r\n    feedback.set('postid', snowball.id);\r\n    feedback.set('author', snowball.author);\r\n    feedback.set('mood', mood);\r\n    feedback.set('comment', comment);\r\n    feedback.save();\r\n  }\r\n\r\n})(jQuery);\r\n"],"sourceRoot":"/source/"}