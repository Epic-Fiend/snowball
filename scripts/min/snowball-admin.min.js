function debounce(t,l){var o=null;return function(){var e=this,n=arguments;clearTimeout(o),o=setTimeout(function(){t.apply(e,n)},l)}}!function(t){var l=!1,o=[];function e(l,o,e){var s=snowball.blocks[l],i=snowball.names[l],r=t("<div class='snowball-block'><div class='snowball-gui'><div class='snowball-tinker'><div><div class='snowball-title'></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-copy' title='Copy block'><i class='fa fa-files-o'></i></div><div class='snowball-title-button snowball-delete' title='Delete block'>&times;</div></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-top' title='Move block to top'><i class='fa fa-angle-double-up'></i></div><div class='snowball-title-button snowball-bottom' title='Move block to bottom'><i class='fa fa-angle-double-down'></i></div></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-zoom-toggle' title='Edit code'><i class='fa fa-code'></i></div></div></div></div><iframe class='snowball-preview'></iframe></div><div class='snowball-code'><div class='snowball-html snowball-editor'><div class='snowball-code-title'>HTML</div><textarea class='snowball-editor-box' data-mode='xml'></textarea></div><div class='snowball-css snowball-editor'><div class='snowball-code-title'>CSS</div><textarea class='snowball-editor-box' data-mode='css'></textarea></div></div></div>");if(r.addClass("snowball-block-"+l).attr("data-type",l).attr("data-name",i).find(".snowball-title").text(i).end().find(".snowball-tinker").append(s).end(),o)for(var c in o){if(o.hasOwnProperty(c)){var d="[data-target='"+c+"']",b=r.find(d),u=o[c];b&&(b.is(":radio")?b.filter("[value='"+u+"']").prop("checked",!0):b.is(":checkbox")?b.prop("checked","true"==u||!0===u):b.val(u))}o.customCss&&r.find("textarea[data-mode='css']").html(o.customCss)}else{var p={blockType:l};snowball.savedblocks.push(p)}r.find(".snowball-preview").load(function(){n(r)}).end().find(".wp-color-picker").wpColorPicker({change:debounce(function(l){t(this).trigger("change").attr("value",t(this).val())},250)}),void 0===e?r.appendTo("#snowball-main"):r.insertAfter(t(".snowball-block").eq(e)),a(r),r.trigger("open")}function n(l){var o=l.data("type"),e=l.find(".snowball-preview").contents(),n=snowball.templates[o];l.find("input[type='text'][data-target], input[type='email'][data-target], input[type='range'][data-target], input[type='hidden'][data-target], input[type='radio'][data-target]:checked, input[type='checkbox'][data-target]:checked, textarea[data-target], select[data-target]").each(function(l,e){var a=t(this).data("target"),s=t(this).val();"text"===o&&t(this).is("textarea")&&(s=s.replace(/\n([ \t]*\n)+/g,"</p><p>").replace(/\n/g,"<br />").replace(/<\/p><p>/g,"</p>\n\t<p>"));var i=new RegExp("{{"+a+"}}","g");n=n.replace(i,s)}),n=(n=n.replace(/{{.+}}/g,"")).replace(/\[author\]/g,snowball.author).replace(/\[blogname\]/g,snowball.blogname).replace(/\[blogurl\]/g,snowball.blogurl).replace(/\[date\]/g,snowball.date).replace(/\[url\]/g,snowball.url),snowball.title&&(n=n.replace(/\[title\]/g,snowball.title));var s=t(n),r=s.find("script").detach();e.find("body").empty().append(s),function(l,o){var e,n=o.find(".snowball-preview"),a=n.contents(),s=a.find("head"),r=a.find("body"),c=o.find(".snowball-code .CodeMirror"),d="",b=snowball.pluginsUrl,u=snowball.includesUrl;if(c.length){var p=c[1].CodeMirror;e=i(p)}else e=o.find("textarea[data-mode='css']").html();if(e){var w=t("<style></style>").attr({"data-type":"custom",scoped:"scoped"});w.html(e),r.find(".snowball-block").append(w)}var f=[u+"js/jquery/jquery.js","https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js","https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js",b+"/lib/d3-geomap/vendor/d3.geomap.dependencies.min.js",b+"/lib/d3-geomap/js/d3.geomap.min.js",b+"/scripts/min/snowball-preview.min.js",b+"/scripts/min/templates.min.js"];[b+"/lib/d3-geomap/css/d3.geomap.css",b+"/lib/font-awesome/css/font-awesome.min.css",b+"/styles/min/snowball.min.css",b+"/styles/min/snowball-theme.min.css",b+"/styles/min/snowball-preview.min.css"].forEach(function(t){d+="<link rel='stylesheet' href='"+t+"'>\n"}),s.is(":empty")?(s.html("<meta charset='utf-8'>"),s.append(d),s.append(t("#snowball-custom-code").val()),function t(l){var o=n.get(0).contentDocument.createElement("script");o.src=f[l];l<f.length-1?o.onload=function(){t(l+1)}:o.onload=function(){m(0)};s[0].appendChild(o)}(0)):m(0);function m(t){if(t<l.length){var o=l.eq(t).attr("src"),e=n.get(0).contentDocument.createElement("script");o?(e.src=o,e.onload=function(){m(t+1)}):e.innerHTML=l.eq(t).html(),r.find(".snowball-block").get(0).appendChild(e)}}}(r,l),l.width()&&a(l),l.trigger("rendered")}function a(l){var o,e;l?(o=l.width()/2,e="scale("+(o<800?o/800:1)+")",l.find(".snowball-preview").contents().find("html").css({"-webkit-transform":e,transform:e})):t(".snowball-preview").each(function(){o=t(this).closest(".snowball-block").width()/2,e="scale("+(o<800?o/800:1)+")",t(this).contents().find("html").css({"-webkit-transform":e,transform:e})})}function s(l,o,e,n){var a="",s=0;if("css"==o){l.find("style:not([data-type='custom'])").each(function(){a+=t(this).html()}),a?(a=a.replace(/^\n+|\n+$/g,""),s=(a+="\n\n").split(/\r\n|\r|\n/).length-1):a="",n&&(a+=n);var r=i(e);r&&(a+=r)}else if("xml"===o){var c=l.clone();c.find("style").remove(),s=(a=c.html().replace("\n\n</section>","\n</section>")).split(/\r\n|\r|\n/).length}var d=e.getCursor(),b=e.getScrollInfo().top,u={line:s,ch:0};e.setValue(a),e.markText({line:0,ch:0},u,{readOnly:!0,inclusiveLeft:!0});for(var p=0;p<s;p++)e.addLineClass(p,"background","readonly");e.setCursor(d),e.scrollTo(null,b)}function i(t){var l=t.getAllMarks(),o=t.getValue();if(l.length){var e=l[0].lines.length;if(e<2)o=t.getValue();else{var n={line:e-1,ch:0},a={line:t.lastLine()+1,ch:0};o=t.getRange(n,a)}}return o}function r(){l=!0,t("#snowball-toolbar .settings .draft, #snowball-toolbar .settings .save").addClass("unsaved")}snowball.status=0===t("#save-post").length?"publish":"draft",jQuery(document).ready(function(){0!==snowball.savedblocks.length&&"null"!==snowball.savedblocks?(t("#snowball_meta").removeClass("closed"),snowball.savedblocks=JSON.parse(snowball.savedblocks),function(){for(var t in snowball.savedblocks){var l=snowball.savedblocks[t],o=l.blockType.toLowerCase();delete l.blockType,delete l.orderNumber,e(o,l)}}()):snowball.savedblocks=[],t("#publish, #save-post").on("click",function(){"publish"==t(this).attr("id")?(snowball.status="publish",o.push({action:"save",type:"publish"})):(snowball.status="draft",o.push({action:"save",type:"draft"})),l=!1}),t("#title").on("input",debounce(function(){snowball.title=t(this).val(),t(".snowball-block").each(function(){t(this).trigger("render")})},250)),t("#snowball-toolbar").css("width",t("#snowball-toolbar").parent().width()).fixedsticky(),t("#snowball-toolbar .block-button").on("click",function(){var l=t(this).data("type");e(l),r(),o.push({action:"add",type:l})}),t("#snowball-toolbar .tag").on("click",function(){var l=t(this).attr("data-tag");t(".tag.active").removeClass("active"),t(this).addClass("active"),"all"===l?t("#snowball-toolbar .buttons .button").removeClass("hidden"):t("#snowball-toolbar .buttons .button").addClass("hidden").filter("."+l).removeClass("hidden")}),t("#snowball-toolbar .settings .button").on("click",function(){var l=t(this).attr("data-click");t(l).click()}),t("#snowball-toolbar .menu-toggle").on("click",function(){var l=t(this).next(".dialog"),o=l.find(".CodeMirror");if(l.addClass("modal"),t("body").toggleClass("modal"),0===o.length&&l.hasClass("settings-dropdown")){var e=l.find("textarea").get(0);o=CodeMirror.fromTextArea(e,{mode:{name:"htmlmixed",htmlMode:!0},lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,theme:"monokai"})}}),t("#snowball-toolbar .menu .close").on("click",function(){var l=t(this).closest(".dialog"),e=l.find(".CodeMirror")[0].CodeMirror.getValue();e&&o.push({action:"code",type:"head",data:e}),l.removeClass("modal"),t("body").removeClass("modal")}),t("#snowball-settings .toggle").on("click",function(){t("#snowball-settings ul").toggle()}),t("#snowball-main").on("render",".snowball-block",function(){var l=t(this);n(l)}).on("mousedown",".snowball-block",function(){t("#snowball-main").height(t("#snowball-main").height())}).on("mouseup",".snowball-block",function(){t("#snowball-main").height("auto")}).on("input change paste",".snowball-tinker input, .snowball-tinker textarea, .snowball-tinker select",debounce(function(){var l=t(this).closest(".snowball-block");l.trigger("render"),function(t){var l=t.find(".snowball-code .CodeMirror");if(l.length){var o=l[0].CodeMirror,e=l[1].CodeMirror,n=t.find(".snowball-preview").contents().find("body");s(n,"xml",o),s(n,"css",e)}}(l),r()},250)).on("click",".snowball-delete",function(){var l=t(this).closest(".snowball-block");l.data("type"),function(t){if(confirm("Are you sure you want to delete this block?")){var l=t.data("type");t.trigger("close").remove(),r(),o.push({action:"delete",type:l})}}(l)}).on("click",".snowball-copy",function(){var l,n,a,s,i=t(this).closest(".snowball-block"),c=i.data("type");n=(l=i).data("type"),a=parseBlock(l),s=l.index(),a&&e(n,a,s),r(),o.push({action:"copy",type:c})}).on("click",".snowball-zoom-toggle",function(){var l=t(this).closest(".snowball-block"),e=l.data("type");if(l.find(".snowball-code, .snowball-copy, .snowball-delete, .snowball-top, .snowball-bottom").toggle(),l.toggleClass("modal"),t("body").toggleClass("modal"),a(l),!l.hasClass("modal")){var n=l.find(".snowball-css .CodeMirror")[0].CodeMirror,s=i(n);o.push({action:"code",type:e,data:s})}l.find(".CodeMirror").each(function(t,l){l.CodeMirror.refresh()})}).on("click",".snowball-top",function(){var l=t(this).closest(".snowball-block");l.index()>0&&(l.parent().prepend(l),r())}).on("click",".snowball-bottom",function(){var l=t(this).closest(".snowball-block");l.index()<t(".snowball-block").length-1&&(l.parent().append(l),r())}).on("mouseover",".snowball-zoom-toggle",function(){var l,o,e=t(this).closest(".snowball-block");0===e.find(".snowball-code .CodeMirror").length&&(o=(l=e).find(".snowball-preview").contents().find("body"),l.find(".snowball-editor-box").each(function(l,e){var a=t(e).attr("data-mode"),i="xml"===a,c=CodeMirror.fromTextArea(e,{mode:{name:a,htmlMode:!0},readOnly:i,lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,theme:"monokai"});s(o,a,c),c.on("change",debounce(function(){var l=t(e).closest(".snowball-block");n(l),r()},250))}))}).on("change",".handsontable",function(){r()}).sortable({axis:"y",cancel:".snowball-block.modal, .snowball-title-button, button, textarea, input, select, .handsontable .wtHider, .CodeMirror, .button, .toggle-buttons",change:function(){r()},containment:"#snowball-main",cursor:"move",tolerance:"pointer"}),t("body").on("click","#modal-bg",function(){t(".snowball-block.modal .snowball-zoom-toggle, .settings-dropdown.modal .close").click(),t(".modal").removeClass("modal")}).on("keydown",function(l){27===l.keyCode&&(t(".snowball-block.modal .snowball-zoom-toggle, .settings-dropdown.modal .close").click(),t(".modal").removeClass("modal"))}),t(window).resize(debounce(function(){a(),t(".fixedsticky").fixedsticky("destroy").fixedsticky()},250)).resize(function(){var l=t(".fixedsticky");l.css("width",l.parent().width())}).on("load",function(){t(".fixedsticky").fixedsticky("destroy").fixedsticky()}).on("beforeunload",function(e){if(function(){var l,e=[],n=[],a=[],s=t(".settings-dropdown .CodeMirror");l=s.length>0?s[0].CodeMirror.getValue():t("#snowball-custom-code").val(),t(".snowball-block").each(function(){var l,o=t(this),s=o.data("type"),r=o.find(".snowball-css .CodeMirror");if(e.push(s),l=r.length>0?i(r[0].CodeMirror):o.find(".snowball-editor-box").val(),a.push({type:s,code:l}),"html"===s){var c=o.find(".snowball-tinker .CodeMirror")[0].CodeMirror.getValue();n.push(c)}});var r=new XMLHttpRequest;r.open("POST","http://129.25.8.18:3030/tasks",!0),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify({blogname:snowball.blogname,blogurl:snowball.blogurl,url:snowball.url,postid:snowball.id,status:snowball.status,author:snowball.authorLogin,user:snowball.userLogin,article:e,size:e.length,actions:o,head:l,css:a,html:n})),o=[]}(),l)return"You may have unsaved changes."}),t("#collapse-menu").click(function(){var l=t(".fixedsticky");l.css("width",l.parent().width()),a()}),t(".hndle, #adv-settings input, .columns-prefs input").on("click",function(){var l=t(".fixedsticky");l.css("width",l.parent().width()),l.fixedsticky("destroy").fixedsticky()}),t("#show-settings-link").on("click",function(){setTimeout(function(){t(".fixedsticky").fixedsticky("destroy").fixedsticky()},200)})})}(jQuery);
//# sourceMappingURL=snowball-admin.min.js.map
