!function(t){function e(){t("#publish, #save-post").on("click",function(){var e={};"publish"==t(this).attr("id")?e.status="publish":e.status="draft",p(e),v=!1}),t("#title").on("input",f(function(){snowball.title=t(this).val(),t(".snowball-block").each(function(){t(this).trigger("render")})},250)),t("#snowball-toolbar").css("width",t("#snowball-toolbar").parent().width()).fixedsticky(),t("#snowball-toolbar .block-button").on("click",function(){var e=t(this).data("type");o(e),w(),g.push({action:"add",type:e})}),t("#snowball-toolbar .tag").on("click",function(){var e=t(this).attr("data-tag");t(".tag.active").removeClass("active"),t(this).addClass("active"),"all"===e?t("#snowball-toolbar .buttons .button").removeClass("hidden"):t("#snowball-toolbar .buttons .button").addClass("hidden").filter("."+e).removeClass("hidden")}),t("#snowball-toolbar .settings .button").on("click",function(){var e=t(this).attr("data-click");t(e).click()}),t("#snowball-toolbar .menu-toggle").on("click",function(){var e=t(this).next(".dialog"),l=e.find(".CodeMirror");if(e.addClass("modal"),t("body").toggleClass("modal"),0===l.length&&e.hasClass("settings-dropdown")){var o=e.find("textarea").get(0);l=CodeMirror.fromTextArea(o,{mode:{name:"htmlmixed",htmlMode:!0},lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,theme:"monokai"})}}),t("#snowball-toolbar .menu .close").on("click",function(){t(this).closest(".dialog").removeClass("modal"),t("body").removeClass("modal")}),t("#snowball-toolbar .feedback .button").on("click",function(){var e=t(this).closest(".feedback"),l=e.attr("data-mood"),o=e.find("textarea").val();m(l,o),e.closest(".dialog").removeClass("modal"),t("body").removeClass("modal"),e.find("textarea").val("")}),t("#snowball-settings .toggle").on("click",function(){t("#snowball-settings ul").toggle()}),t("#snowball-main").on("render",".snowball-block",function(){var e=t(this);n(e)}).on("mousedown",".snowball-block",function(){t("#snowball-main").height(t("#snowball-main").height())}).on("mouseup",".snowball-block",function(){t("#snowball-main").height("auto")}).on("input change paste",".snowball-tinker input, .snowball-tinker textarea, .snowball-tinker select",f(function(){var e=t(this).closest(".snowball-block");e.trigger("render"),b(e),w()},250)).on("click",".snowball-delete",function(){var e=t(this).closest(".snowball-block");e.data("type");u(e)}).on("click",".snowball-copy",function(){var e=t(this).closest(".snowball-block"),l=e.data("type");d(e),w(),g.push({action:"copy",type:l})}).on("click",".snowball-zoom-toggle",function(){var e=t(this).closest(".snowball-block"),l=e.data("type");e.find(".snowball-code, .snowball-copy, .snowball-delete, .snowball-top, .snowball-bottom").toggle(),e.toggleClass("modal"),t("body").toggleClass("modal"),s(e),g.push({action:"code",type:l}),e.find(".CodeMirror").each(function(t,e){e.CodeMirror.refresh()})}).on("click",".snowball-top",function(){var e=t(this).closest(".snowball-block");e.index()>0&&(e.parent().prepend(e),w())}).on("click",".snowball-bottom",function(){var e=t(this).closest(".snowball-block");e.index()<t(".snowball-block").length-1&&(e.parent().append(e),w())}).on("mouseover",".snowball-zoom-toggle",function(){var e=t(this).closest(".snowball-block");0===e.find(".snowball-code .CodeMirror").length&&i(e)}).on("change",".handsontable",function(){w()}).sortable({axis:"y",cancel:".snowball-block.modal, .snowball-title-button, button, textarea, input, select, .handsontable .wtHider, .CodeMirror, .button, .toggle-buttons",change:function(){w()},containment:"#snowball-main",cursor:"move",tolerance:"pointer"}),t("body").on("click","#modal-bg",function(){t(".snowball-block.modal .snowball-zoom-toggle").click(),t(".modal").removeClass("modal")}).on("keydown",function(e){27===e.keyCode&&(t(".snowball-block.modal .snowball-zoom-toggle").click(),t(".modal").removeClass("modal"))}),t(window).resize(f(function(){s(),t(".fixedsticky").fixedsticky("destroy").fixedsticky()},250)).resize(function(){var e=t(".fixedsticky");e.css("width",e.parent().width())}).on("load",function(){t(".fixedsticky").fixedsticky("destroy").fixedsticky()}).on("beforeunload",function(t){return v?"You may have unsaved changes.":void 0}),t("#collapse-menu").click(function(){var e=t(".fixedsticky");e.css("width",e.parent().width()),s()}),t(".hndle, #adv-settings input, .columns-prefs input").on("click",function(){var e=t(".fixedsticky");e.css("width",e.parent().width()),e.fixedsticky("destroy").fixedsticky()}),t("#show-settings-link").on("click",function(){setTimeout(function(){t(".fixedsticky").fixedsticky("destroy").fixedsticky()},200)})}function l(){for(var t in snowball.savedblocks){var e=snowball.savedblocks[t],l=e.blockType.toLowerCase();delete e.blockType,delete e.orderNumber,o(l,e)}}function o(e,l,o){var a=snowball.blocks[e],i=snowball.names[e],c=t("<div class='snowball-block'><div class='snowball-gui'><div class='snowball-tinker'><div><div class='snowball-title'></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-copy' title='Copy block'><i class='fa fa-files-o'></i></div><div class='snowball-title-button snowball-delete' title='Delete block'>&times;</div></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-top' title='Move block to top'><i class='fa fa-angle-double-up'></i></div><div class='snowball-title-button snowball-bottom' title='Move block to bottom'><i class='fa fa-angle-double-down'></i></div></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-zoom-toggle' title='Edit code'><i class='fa fa-code'></i></div></div></div></div><iframe class='snowball-preview'></iframe></div><div class='snowball-code'><div class='snowball-html snowball-editor'><div class='snowball-code-title'>HTML</div><textarea class='snowball-editor-box' data-mode='xml'></textarea></div><div class='snowball-css snowball-editor'><div class='snowball-code-title'>CSS</div><textarea class='snowball-editor-box' data-mode='css'></textarea></div></div></div>");if(c.addClass("snowball-block-"+e).attr("data-type",e).attr("data-name",i).find(".snowball-title").text(i).end().find(".snowball-tinker").append(a).end(),l)for(var r in l){if(l.hasOwnProperty(r)){var d="[data-target='"+r+"']",b=c.find(d),u=l[r];b&&(b.is(":radio")?b.filter("[value='"+u+"']").prop("checked",!0):b.is(":checkbox")?b.prop("checked","true"==u||u===!0):b.val(u))}l.customCss&&c.find("textarea[data-mode='css']").html(l.customCss)}else{var w={blockType:e};snowball.savedblocks.push(w)}c.find(".snowball-preview").load(function(){n(c)}).end().find(".wp-color-picker").wpColorPicker({change:f(function(e){t(this).trigger("change").attr("value",t(this).val())},250)}),"undefined"==typeof o?c.appendTo("#snowball-main"):c.insertAfter(t(".snowball-block").eq(o)),s(c),c.trigger("open")}function n(e){var l=e.data("type"),o=e.find(".snowball-preview").contents(),n=snowball.templates[l],i="input[type='text'][data-target], input[type='email'][data-target], input[type='range'][data-target], input[type='hidden'][data-target], input[type='radio'][data-target]:checked, input[type='checkbox'][data-target]:checked, textarea[data-target], select[data-target]",c=e.find(i);c.each(function(e,o){var a=t(this).data("target"),s=t(this).val();"text"===l&&t(this).is("textarea")&&(s=s.replace(/\n([ \t]*\n)+/g,"</p><p>").replace(/\n/g,"<br />").replace(/<\/p><p>/g,"</p>\n	<p>"));var i=new RegExp("{{"+a+"}}","g");n=n.replace(i,s)}),n=n.replace(/{{.+}}/g,""),n=n.replace(/\[author\]/g,snowball.author).replace(/\[blogname\]/g,snowball.blogname).replace(/\[blogurl\]/g,snowball.blogurl).replace(/\[date\]/g,snowball.date).replace(/\[url\]/g,snowball.url),snowball.title&&(n=n.replace(/\[title\]/g,snowball.title));var r=t(n),d=r.find("script").detach();o.find("body").empty().append(r),a(d,e),e.width()&&s(e),e.trigger("rendered")}function a(e,l){function o(t){var e=s.get(0).contentDocument.createElement("script");e.src=g[t],t<g.length-1?e.onload=function(){o(t+1)}:e.onload=function(){n(0)},c[0].appendChild(e)}function n(t){if(t<e.length){var l=e.eq(t).attr("src"),o=s.get(0).contentDocument.createElement("script");l?(o.src=l,o.onload=function(){n(t+1)}):o.innerHTML=e.eq(t).html(),d.find(".snowball-block").get(0).appendChild(o)}}var a,s=l.find(".snowball-preview"),i=s.contents(),c=i.find("head"),d=i.find("body"),b=l.find(".snowball-code .CodeMirror"),u="",w=snowball.pluginsUrl,f=snowball.includesUrl;if(b.length){var p=b[1].CodeMirror;a=r(p)}else a=l.find("textarea[data-mode='css']").html();if(a){var m=t("<style></style>").attr({"data-type":"custom",scoped:"scoped"});m.html(a),d.find(".snowball-block").append(m)}var v=[w+"/lib/d3-geomap/css/d3.geomap.css",w+"/lib/font-awesome/css/font-awesome.min.css",w+"/styles/min/snowball.min.css",w+"/styles/min/snowball-theme.min.css",w+"/styles/min/snowball-preview.min.css"],g=[f+"js/jquery/jquery.js","https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js","https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js",w+"/lib/d3-geomap/vendor/d3.geomap.dependencies.min.js",w+"/lib/d3-geomap/js/d3.geomap.min.js",w+"/scripts/min/snowball-preview.min.js",w+"/scripts/min/templates.min.js"];v.forEach(function(t){var e="<link rel='stylesheet' href='"+t+"'>\n";u+=e}),c.is(":empty")?(c.html("<meta charset='utf-8'>"),c.append(u),c.append(t("#snowball-custom-code").val()),o(0)):n(0)}function s(e){var l,o,n;e?(l=e.width()/2,o=800>l?l/800:1,n="scale("+o+")",e.find(".snowball-preview").contents().find("html").css({"-webkit-transform":n,transform:n})):t(".snowball-preview").each(function(){l=t(this).closest(".snowball-block").width()/2,o=800>l?l/800:1,n="scale("+o+")",t(this).contents().find("html").css({"-webkit-transform":n,transform:n})})}function i(e){var l=e.find(".snowball-preview").contents().find("body"),o=e.find(".snowball-editor-box");o.each(function(e,o){var a=t(o).attr("data-mode"),s="xml"===a?!0:!1,i=CodeMirror.fromTextArea(o,{mode:{name:a,htmlMode:!0},readOnly:s,lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,theme:"monokai"});c(l,a,i),i.on("change",f(function(){var e=t(o).closest(".snowball-block");n(e),w()},250))})}function c(e,l,o,n){var a="",s=0;if("css"==l){e.find("style:not([data-type='custom'])").each(function(){a+=t(this).html()}),a?(a=a.replace(/^\n+|\n+$/g,""),a+="\n\n",s=a.split(/\r\n|\r|\n/).length-1):a="",n&&(a+=n);var i=r(o);i&&(a+=i)}else if("xml"===l){var c=e.clone();c.find("style").remove(),a=c.html().replace("\n\n</section>","\n</section>"),s=a.split(/\r\n|\r|\n/).length}var d=o.getCursor(),b=o.getScrollInfo().top,u={line:0,ch:0},w={line:s,ch:0},f={readOnly:!0,inclusiveLeft:!0};o.setValue(a),o.markText(u,w,f);for(var p=0;s>p;p++)o.addLineClass(p,"background","readonly");o.setCursor(d),o.scrollTo(null,b)}function r(t){var e=t.getAllMarks(),l=t.getValue();if(e.length){var o=e[0],n=o.lines.length;if(2>n)l=t.getValue();else{var a={line:n-1,ch:0},s={line:t.lastLine()+1,ch:0};l=t.getRange(a,s)}}return l}function d(t){var e=t.data("type"),l=parseBlock(t),n=t.index();l&&o(e,l,n)}function b(t){var e=t.find(".snowball-code .CodeMirror");if(e.length){var l=e[0].CodeMirror,o=e[1].CodeMirror,n=t.find(".snowball-preview").contents().find("body");c(n,"xml",l),c(n,"css",o)}}function u(t){var e=confirm("Are you sure you want to delete this block?");if(e){var l=t.data("type");t.trigger("close").remove(),w(),g.push({action:"delete",type:l})}}function w(){v=!0,t("#snowball-toolbar .settings .draft, #snowball-toolbar .settings .save").addClass("unsaved")}function f(t,e){var l=null;return function(){var o=this,n=arguments;clearTimeout(l),l=setTimeout(function(){t.apply(o,n)},e)}}function p(e){var l=[];t(".snowball-block").each(function(){var e=t(this).data("type");l.push(e)}),Parse.initialize("FwVMmzHookZZ5j9F9ILc2E5MT5ufabuV7hCXKSeu","Q069j2TUEegDfQJXxxYp7OIZrgu7ySYcqmSU05pQ");var o=Parse.Object.extend("Blocks"),n=new o;n.set("blogname",snowball.blogname),n.set("blogurl",snowball.blogurl),n.set("url",snowball.url),n.set("postid",snowball.id),n.set("status",e.status),n.set("author",snowball.authorLogin),n.set("user",snowball.userLogin),n.set("article",l),n.set("size",l.length),n.set("actions",g),n.save(),g=[]}function m(t,e){Parse.initialize("FwVMmzHookZZ5j9F9ILc2E5MT5ufabuV7hCXKSeu","Q069j2TUEegDfQJXxxYp7OIZrgu7ySYcqmSU05pQ");var l=Parse.Object.extend("Feedback"),o=new l;o.set("blogname",snowball.blogname),o.set("blogurl",snowball.blogurl),o.set("url",snowball.url),o.set("postid",snowball.id),o.set("author",snowball.authorLogin),o.set("user",snowball.userLogin),o.set("mood",t),o.set("comment",e),o.save()}var v=!1,g=[];jQuery(document).ready(function(){0!==snowball.savedblocks.length&&"null"!==snowball.savedblocks?(t("#snowball_meta").removeClass("closed"),snowball.savedblocks=JSON.parse(snowball.savedblocks),l()):snowball.savedblocks=[],e()})}(jQuery);
//# sourceMappingURL=snowball-admin.min.js.map