!function(e){function t(){e("#publish, #save-post").on("click",function(){var t={};t.status="publish"==e(this).attr("id")?"publish":"draft",p(t),m=!1}),e("#title").on("input",w(function(){snowball.title=e(this).val(),e(".snowball-block").each(function(){e(this).trigger("render")})},250)),e("#snowball-toolbar").on("click",".block-button",function(){var t=e(this).data("type");l(t),m=!0,v.push({action:"add",type:t})}).on("click",".tag",function(){var t=e(this).attr("data-tag");e(".tag.active").removeClass("active"),e(this).addClass("active"),"all"===t?e("#snowball-toolbar .button").show():e("#snowball-toolbar .button").hide().filter("."+t).show()}).on("click",".feedback",function(){var t=e("#feedback-form");e(this).hasClass("happy")?(t.data("mood","positive"),t.find(".header").text("How did Snowball make you happy?")):(t.data("mood","negative"),t.find(".header").text("How did Snowball make you sad, frustrated, or annoyed?")),t.toggle()}).on("click","#feedback-form .close",function(){e("#feedback-form").hide()}).on("click","#feedback-form .button",function(){var t=e("#feedback-form"),o=t.data("mood"),l=t.find("textarea").val();f(o,l),t.hide(),t.find("textarea").val("")}).css("width",e("#snowball-toolbar").parent().width()).fixedsticky(),e("#snowball-main").on("render",".snowball-block",function(){var t=e(this);a(t)}).on("mousedown",".snowball-block",function(){e("#snowball-main").height(e("#snowball-main").height())}).on("mouseup",".snowball-block",function(){e("#snowball-main").height("auto")}).on("input change paste",".snowball-tinker input, .snowball-tinker textarea:not(.handsontableInput), .snowball-tinker select",w(function(){var t=e(this).closest(".snowball-block");t.trigger("render"),b(t),m=!0},250)).on("click",".snowball-delete",function(){{var t=e(this).closest(".snowball-block");t.data("type")}u(t)}).on("click",".snowball-copy",function(){var t=e(this).closest(".snowball-block"),o=t.data("type");d(t),v.push({action:"copy",type:o})}).on("click",".snowball-zoom-toggle",function(){var t=e(this).closest(".snowball-block"),o=t.data("type");t.find(".snowball-code, .snowball-copy, .snowball-delete, .snowball-top, .snowball-bottom").toggle(),t.toggleClass("modal"),e("body").toggleClass("modal"),s(t),v.push({action:"code",type:o}),t.find(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()})}).on("click",".snowball-top",function(){var t=e(this).closest(".snowball-block");t.parent().prepend(t)}).on("click",".snowball-bottom",function(){var t=e(this).closest(".snowball-block");t.parent().append(t)}).on("mouseover",".snowball-zoom-toggle",function(){var t=e(this).closest(".snowball-block");0===t.find(".snowball-code .CodeMirror").length&&i(t)}).on("change",".handsontable",function(){m=!0}).sortable({axis:"y",containment:"#snowball-main",cancel:".snowball-block.modal, .snowball-title-button, button, textarea, input, select, .handsontable .wtHider, .CodeMirror, .toggle-buttons",cursor:"move",tolerance:"pointer"}),e("body").on("click","#modal-bg",function(){e(".snowball-block.modal .snowball-zoom-toggle").click()}).on("keydown",function(t){27===t.keyCode&&e(".snowball-block.modal .snowball-zoom-toggle").click()}),e("#adminmenuback").on("mouseenter",function(){e("body").addClass("show-menu")}),e("#adminmenuwrap").on("mouseleave",function(){e("body").removeClass("show-menu")}),e("#wpwrap").on("click",function(){e("body").removeClass("show-menu")}),e(window).resize(w(function(){s()},250)).resize(function(){var t=e(".fixedsticky");t.css("width",t.parent().width())}).on("beforeunload",function(e){return m?"You may have unsaved changes.":void 0}),e("#collapse-menu").click(function(){var t=e(".fixedsticky");t.css("width",t.parent().width()),s()})}function o(){for(var e in snowball.savedblocks){var t=snowball.savedblocks[e],o=t.blockType.toLowerCase();delete t.blockType,delete t.orderNumber,l(o,t)}}function l(t,o,l){var n=snowball.blocks[t],i=snowball.names[t],c=e("<div class='snowball-block'><div class='snowball-gui'><div class='snowball-tinker'><div><div class='snowball-title'></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-copy' title='Copy block'><i class='fa fa-files-o'></i></div><div class='snowball-title-button snowball-delete' title='Delete block'>&times;</div></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-top' title='Move block to top'><i class='fa fa-angle-double-up'></i></div><div class='snowball-title-button snowball-bottom' title='Move block to bottom'><i class='fa fa-angle-double-down'></i></div></div><div class='snowball-title-button-group'><div class='snowball-title-button snowball-zoom-toggle' title='Edit code'><i class='fa fa-code'></i></div></div></div></div><iframe class='snowball-preview'></iframe></div><div class='snowball-code'><div class='snowball-html snowball-editor'><div class='snowball-code-title'>HTML</div><textarea class='snowball-editor-box' data-mode='xml'></textarea></div><div class='snowball-css snowball-editor'><div class='snowball-code-title'>CSS</div><textarea class='snowball-editor-box' data-mode='css'></textarea></div></div></div>");if(c.addClass("snowball-block-"+t).attr("data-type",t).attr("data-name",i).find(".snowball-title").text(i).end().find(".snowball-tinker").append(n).end(),o)for(var r in o){if(o.hasOwnProperty(r)){var d="[data-target='"+r+"']",b=c.find(d),u=o[r];b&&(b.is(":radio")?b.filter("[value='"+u+"']").prop("checked",!0):b.is(":checkbox")?b.prop("checked","true"==u||u===!0):b.val(u))}o.customCss&&c.find("textarea[data-mode='css']").html(o.customCss)}else{var p={blockType:t};snowball.savedblocks.push(p)}c.find(".snowball-preview").load(function(){a(c)}).end().find(".wp-color-picker").wpColorPicker({change:w(function(t){e(this).trigger("change").attr("value",e(this).val())},250)}),"undefined"==typeof l?c.appendTo("#snowball-main"):c.insertAfter(e(".snowball-block").eq(l)),s(c),c.trigger("open")}function a(t){var o=t.data("type"),l=t.find(".snowball-preview").contents(),a=snowball.templates[o],i="input[type='text'][data-target], input[type='email'][data-target], input[type='range'][data-target], input[type='hidden'][data-target], input[type='radio'][data-target]:checked, input[type='checkbox'][data-target]:checked, textarea[data-target], select[data-target]",c=t.find(i);c.each(function(t,l){var n=e(this).data("target"),s=e(this).val();"text"===o&&e(this).is("textarea")&&(s=s.replace(/(.+?)\n{2,}/g,"<p>$1</p>"));var i=new RegExp("{{"+n+"}}","g");a=a.replace(i,s)}),a=a.replace(/{{.+}}/g,""),a=a.replace(/\[author\]/g,snowball.author).replace(/\[blogname\]/g,snowball.blogname).replace(/\[blogurl\]/g,snowball.blogurl).replace(/\[date\]/g,snowball.date).replace(/\[url\]/g,snowball.url),snowball.title&&(a=a.replace(/\[title\]/g,snowball.title));var r=e(a),d=r.find("script").detach();l.find("body").empty().append(r),n(d,t),t.width()&&s(t),t.trigger("rendered")}function n(t,o){function l(e){var t=s.get(0).contentDocument.createElement("script");t.src=h[e],t.onload=e<h.length-1?function(){l(e+1)}:function(){a(0)},c[0].appendChild(t)}function a(e){if(e<t.length){var o=t.eq(e).attr("src"),l=s.get(0).contentDocument.createElement("script");o?(l.src=o,l.onload=function(){a(e+1)}):l.innerHTML=t.eq(e).html(),d.find(".snowball-block").get(0).appendChild(l)}}var n,s=o.find(".snowball-preview"),i=s.contents(),c=i.find("head"),d=i.find("body"),b=o.find(".snowball-code .CodeMirror"),u="",w=snowball.pluginsUrl,p=snowball.includesUrl;if(b.length){var f=b[1].CodeMirror;n=r(f)}else n=o.find("textarea[data-mode='css']").html();if(n){var m=e("<style></style>").attr({"data-type":"custom",scoped:"scoped"});m.html(n),d.find(".snowball-block").append(m)}var v=[w+"/lib/d3-geomap/css/d3.geomap.css",w+"/lib/font-awesome/css/font-awesome.min.css",w+"/styles/min/snowball.min.css",w+"/styles/min/snowball-preview.min.css"],h=[p+"js/jquery/jquery.js","https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js","https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js",w+"/lib/d3-geomap/vendor/d3.geomap.dependencies.min.js",w+"/lib/d3-geomap/js/d3.geomap.min.js",w+"/scripts/min/snowball-preview.min.js",w+"/scripts/min/templates.min.js"];v.forEach(function(e){var t="<link rel='stylesheet' href='"+e+"'>\n";u+=t}),c.is(":empty")?(c.html("<meta charset='utf-8'>"),c.append(u),l(0)):a(0)}function s(t){var o,l,a;t?(o=t.width()/2,l=800>o?o/800:1,a="scale("+l+")",t.find(".snowball-preview").contents().find("html").css({"-webkit-transform":a,transform:a})):e(".snowball-preview").each(function(){o=e(this).closest(".snowball-block").width()/2,l=800>o?o/800:1,a="scale("+l+")",e(this).contents().find("html").css({"-webkit-transform":a,transform:a})})}function i(t){var o=t.find(".snowball-preview").contents().find("body"),l=t.find(".snowball-editor-box");l.each(function(t,l){var n=e(l).attr("data-mode"),s="xml"===n?!0:!1,i=CodeMirror.fromTextArea(l,{mode:{name:n,htmlMode:!0},readOnly:s,lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,theme:"monokai"});c(o,n,i),i.on("change",w(function(){var t=e(l).closest(".snowball-block");a(t),m=!0},250))})}function c(t,o,l,a){var n="",s=0;if("css"==o){t.find("style:not([data-type='custom'])").each(function(){n+=e(this).html()}),n?(n=n.replace(/^\n+|\n+$/g,""),n+="\n\n",s=n.split(/\r\n|\r|\n/).length-1):n="",a&&(n+=a);var i=r(l);i&&(n+=i)}else if("xml"===o){var c=t.clone();c.find("style").remove(),n=c.html().replace("\n\n</section>","\n</section>"),s=n.split(/\r\n|\r|\n/).length}var d=l.getCursor(),b=l.getScrollInfo().top,u={line:0,ch:0},w={line:s,ch:0},p={readOnly:!0,inclusiveLeft:!0};l.setValue(n),l.markText(u,w,p);for(var f=0;s>f;f++)l.addLineClass(f,"background","readonly");l.setCursor(d),l.scrollTo(null,b)}function r(e){var t=e.getAllMarks(),o=e.getValue();if(t.length){var l=t[0],a=l.lines.length;if(2>a)o=e.getValue();else{var n={line:a-1,ch:0},s={line:e.lastLine()+1,ch:0};o=e.getRange(n,s)}}return o}function d(e){var t=e.data("type"),o=parseBlock(e),a=e.index();o&&l(t,o,a)}function b(e){var t=e.find(".snowball-code .CodeMirror");if(t.length){var o=t[0].CodeMirror,l=t[1].CodeMirror,a=e.find(".snowball-preview").contents().find("body");c(a,"xml",o),c(a,"css",l)}}function u(e){var t=confirm("Are you sure you want to delete this block?");if(t){var o=e.data("type");e.trigger("close").remove(),m=!0,v.push({action:"delete",type:o})}}function w(e,t){var o=null;return function(){var l=this,a=arguments;clearTimeout(o),o=setTimeout(function(){e.apply(l,a)},t)}}function p(t){var o=[];e(".snowball-block").each(function(){var t=e(this).data("type");o.push(t)}),Parse.initialize("FwVMmzHookZZ5j9F9ILc2E5MT5ufabuV7hCXKSeu","Q069j2TUEegDfQJXxxYp7OIZrgu7ySYcqmSU05pQ");var l=Parse.Object.extend("Blocks"),a=new l;a.set("blogname",snowball.blogname),a.set("blogurl",snowball.blogurl),a.set("url",snowball.url),a.set("postid",snowball.id),a.set("status",t.status),a.set("author",snowball.authorLogin),a.set("user",snowball.userLogin),a.set("article",o),a.set("size",o.length),a.set("actions",v),a.save(),v=[]}function f(e,t){Parse.initialize("FwVMmzHookZZ5j9F9ILc2E5MT5ufabuV7hCXKSeu","Q069j2TUEegDfQJXxxYp7OIZrgu7ySYcqmSU05pQ");var o=Parse.Object.extend("Feedback"),l=new o;l.set("blogname",snowball.blogname),l.set("blogurl",snowball.blogurl),l.set("url",snowball.url),l.set("postid",snowball.id),l.set("author",snowball.author),l.set("mood",e),l.set("comment",t),l.save()}var m=!1,v=[];jQuery(document).ready(function(){0!==snowball.savedblocks.length&&"null"!==snowball.savedblocks?(snowball.savedblocks=JSON.parse(snowball.savedblocks),o()):snowball.savedblocks=[],t()})}(jQuery);
//# sourceMappingURL=snowball-admin.min.js.map