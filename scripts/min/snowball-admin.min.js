!function(e){function t(){e("#publish, #save-post").on("click",function(){p=!1}),e("#snowball-toolbar").on("click",".button",function(){var t=e(this).data("type");a(t),p=!0}).on("click",".tag",function(){var t=e(this).attr("data-tag");e(".tag.active").removeClass("active"),e(this).addClass("active"),"all"===t?e("#snowball-toolbar .button").show():e("#snowball-toolbar .button").hide().filter("."+t).show()}).css("width",e("#snowball-toolbar").parent().width()).fixedsticky(),e("#snowball-main").on("render",".snowball-block",function(){var t=e(this);l(t)}).on("mousedown",".snowball-block",function(){e("#snowball-main").height(e("#snowball-main").height())}).on("mouseup",".snowball-block",function(){e("#snowball-main").height("auto")}).on("input change",".snowball-tinker input, .snowball-tinker textarea:not(.handsontableInput), .snowball-tinker select",f(function(){var t=e(this).closest(".snowball-block");t.trigger("render"),u(t),p=!0},250)).on("click",".snowball-delete",function(){var t=e(this).closest(".snowball-block");w(t),p=!0}).on("click",".snowball-zoom-toggle",function(){var t=e(this).closest(".snowball-block");t.find(".snowball-code, .snowball-copy, .snowball-delete").toggle(),t.toggleClass("modal"),e("body").toggleClass("modal"),s(t),t.find(".CodeMirror").each(function(e,t){t.CodeMirror.refresh()})}).on("click",".snowball-copy",function(){var t=e(this).closest(".snowball-block");d(t)}).on("mouseover",".snowball-zoom-toggle",function(){var t=e(this).closest(".snowball-block");0===t.find(".snowball-code .CodeMirror").length&&i(t)}).sortable({axis:"y",containment:"#snowball-main",cancel:".snowball-block.modal, textarea, input, select, .handsontable .wtHider, .CodeMirror",cursor:"move",tolerance:"pointer"}),e("body").on("click","#modal-bg",function(){e(".snowball-block.modal .snowball-zoom-toggle").click()}).on("keydown",function(t){27===t.keyCode&&e(".snowball-block.modal .snowball-zoom-toggle").click()}),e("#adminmenuback").on("mouseenter",function(){e("body").addClass("show-menu")}),e("#adminmenuwrap").on("mouseleave",function(){e("body").removeClass("show-menu")}),e("#wpwrap").on("click",function(){e("body").removeClass("show-menu")}),e(window).resize(f(function(){s()},250)).resize(function(){var t=e(".fixedsticky");t.css("width",t.parent().width())}).on("beforeunload",function(e){return p?"You may have unsaved changes.":void 0}),e("#collapse-menu").click(function(){var t=e(".fixedsticky");t.css("width",t.parent().width()),s()})}function n(){for(var e in snowball.savedblocks){var t=snowball.savedblocks[e],n=t.blockType.toLowerCase();delete t.blockType,delete t.orderNumber,a(n,t)}}function a(t,n,a){var o=snowball.blocks[t],s=snowball.names[t],i=e("<div class='snowball-block'><div class='snowball-gui'><div class='snowball-tinker'><div><div class='snowball-title'></div><div class='snowball-title-button snowball-delete'>&times;</div><div class='snowball-title-button snowball-copy'><i class='fa fa-files-o'></i></div><div class='snowball-title-button snowball-zoom-toggle'><i class='fa fa-code'></i></div></div></div><iframe class='snowball-preview'></iframe></div><div class='snowball-code'><div class='snowball-html snowball-editor'><div class='snowball-code-title'>HTML</div><textarea class='snowball-editor-box' data-mode='xml'></textarea></div><div class='snowball-css snowball-editor'><div class='snowball-code-title'>CSS</div><textarea class='snowball-editor-box' data-mode='css'></textarea></div></div></div>");if(i.addClass("snowball-block-"+t).attr("data-type",t).attr("data-name",s).find(".snowball-title").text(s).end().find(".snowball-tinker").append(o).end(),n)for(var r in n){if(n.hasOwnProperty(r)){var c="[data-target='"+r+"']",d=i.find(c),b=n[r];d&&(d.is(":radio")?d.filter("[value='"+b+"']").prop("checked",!0):d.is(":checkbox")?"true"==b?d.prop("checked",!0):d.prop("checked",!1):d.val(b))}n.customCss&&i.find("textarea[data-mode='css']").html(n.customCss)}else{var u={orderNumber:snowball.savedblocks.length,blockType:t};snowball.savedblocks.push(u)}i.find(".snowball-preview").load(function(){l(i)}).end().find(".wp-color-picker").wpColorPicker({change:f(function(t){e(this).trigger("change").attr("value",e(this).val())},250)}),a?i.insertAfter(e(".snowball-block").eq(a)):i.appendTo("#snowball-main"),i.trigger("open")}function l(t){var n=t.data("type"),a=t.find(".snowball-preview").contents(),l=snowball.templates[n],i="input[type='text'][data-target], input[type='email'][data-target], input[type='range'][data-target], input[type='hidden'][data-target], input[type='radio'][data-target]:checked, input[type='checkbox'][data-target]:checked, textarea[data-target], select[data-target]",r=t.find(i);r.each(function(t,a){var o=e(this).data("target"),s=e(this).val();"text"===n&&e(this).is("textarea")&&(s=s.replace(/(.+?)\n{2,}/g,"<p>$1</p>"));var i=new RegExp("{{"+o+"}}","g");l=l.replace(i,s)}),l=l.replace(/{{.+}}/g,""),l=l.replace(/\[author\]/g,snowball.author).replace(/\[blogname\]/g,snowball.blogname).replace(/\[blogurl\]/g,snowball.blogurl).replace(/\[date\]/g,snowball.date).replace(/\[url\]/g,snowball.url),snowball.title&&(l=l.replace(/\[title\]/g,snowball.title));var c=e(l),d=c.find("script").detach();a.find("body").empty().append(c),o(d,t),t.width()&&s(t),t.trigger("rendered")}function o(t,n){function a(e){var t=s.get(0).contentDocument.createElement("script");t.src=h[e],t.onload=e<h.length-1?function(){a(e+1)}:function(){l(0)},r[0].appendChild(t)}function l(e){if(e<t.length){var n=t.eq(e).attr("src"),a=s.get(0).contentDocument.createElement("script");n?(a.src=n,a.onload=function(){l(e+1)}):a.innerHTML=t.eq(e).html(),d.find(".snowball-block").get(0).appendChild(a)}}var o,s=n.find(".snowball-preview"),i=s.contents(),r=i.find("head"),d=i.find("body"),b=n.find(".snowball-code .CodeMirror"),u="",w=snowball.pluginsUrl,f=snowball.includesUrl;if(b.length){var p=b[1].CodeMirror;o=c(p)}else o=n.find("textarea[data-mode='css']").html();if(o){var m=e("<style></style>").attr({"data-type":"custom",scoped:"scoped"});m.html(o),d.find(".snowball-block").append(m)}var v=[w+"/lib/d3-geomap/css/d3.geomap.css",w+"/lib/font-awesome/css/font-awesome.min.css",w+"/styles/min/snowball.min.css",w+"/styles/min/snowball-preview.min.css"],h=[f+"js/jquery/jquery.js","https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js","https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js",w+"/lib/d3-geomap/vendor/d3.geomap.dependencies.min.js",w+"/lib/d3-geomap/js/d3.geomap.min.js",w+"/scripts/min/snowball-preview.min.js",w+"/scripts/min/templates.min.js"];v.forEach(function(e){var t="<link rel='stylesheet' href='"+e+"'>\n";u+=t}),r.is(":empty")?(r.html("<meta charset='utf-8'>"),r.append(u),a(0)):l(0)}function s(t){var n,a,l;t?(n=t.width()/2,a=800>n?n/800:1,l="scale("+a+")",t.find(".snowball-preview").contents().find("html").css({"-webkit-transform":l,transform:l})):e(".snowball-preview").each(function(){n=e(this).closest(".snowball-block").width()/2,a=800>n?n/800:1,l="scale("+a+")",e(this).contents().find("html").css({"-webkit-transform":l,transform:l})})}function i(t){var n=t.find(".snowball-preview").contents().find("body"),a=t.find(".snowball-editor-box");a.each(function(t,a){var o=e(a).attr("data-mode"),s="xml"===o?!0:!1,i=CodeMirror.fromTextArea(a,{mode:{name:o,htmlMode:!0},readOnly:s,lineNumbers:!0,lineWrapping:!0,indentUnit:2,tabSize:2,theme:"monokai"});r(n,o,i),i.on("change",f(function(){var t=e(a).closest(".snowball-block");l(t),p=!0},250))})}function r(t,n,a,l){var o="",s=0;if("css"==n){t.find("style:not([data-type='custom'])").each(function(){o+=e(this).html()}),o?(o=o.replace(/^\n+|\n+$/g,""),o+="\n\n",s=o.split(/\r\n|\r|\n/).length-1):o="",l&&(o+=l);var i=c(a);i&&(o+=i)}else if("xml"===n){var r=t.clone();r.find("style").remove(),o=r.html().replace("\n\n</section>","\n</section>"),s=o.split(/\r\n|\r|\n/).length}var d=a.getCursor(),b=a.getScrollInfo().top,u={line:0,ch:0},w={line:s,ch:0},f={readOnly:!0,inclusiveLeft:!0};a.setValue(o),a.markText(u,w,f);for(var p=0;s>p;p++)a.addLineClass(p,"background","readonly");a.setCursor(d),a.scrollTo(null,b)}function c(e){var t=e.getAllMarks(),n=e.getValue();if(t.length){var a=t[0],l=a.lines.length;if(2>l)n=e.getValue();else{var o={line:l-1,ch:0},s={line:e.lastLine()+1,ch:0};n=e.getRange(o,s)}}return n}function d(t){var n=t.index(),l=t.data("type"),o="input[type='text'][data-target], input[type='email'][data-target], input[type='range'][data-target], input[type='hidden'][data-target], input[type='radio'][data-target]:checked, input[type='checkbox'][data-target], textarea[data-target], select[data-target]",s=t.find(".snowball-tinker form").find(o);if(s){var i={blockType:l};s.each(function(t,n){var a=e(n).attr("data-target"),l=e(n).val();"checkbox"==e(n).attr("type")&&(l=e(n).is(":checked")?!0:!1),i[a]=l}),i.customCss=b(t),a(l,i,n)}}function b(t){var n,a=e(t).find(".snowball-code .CodeMirror");if(0===a.length)n=e(t).find("textarea[data-mode='css']").html();else{var l=a[1].CodeMirror,o=l.getAllMarks();if(n=l.getValue(),o.length){var s=o[0],i=s.lines.length;if(2>i)n=l.getValue();else{var r={line:i-1,ch:0},c={line:l.lastLine()+1,ch:0};n=l.getRange(r,c)}}}return n}function u(e){var t=e.find(".snowball-code .CodeMirror");if(t.length){var n=t[0].CodeMirror,a=t[1].CodeMirror,l=e.find(".snowball-preview").contents().find("body");r(l,"xml",n),r(l,"css",a)}}function w(e){var t=confirm("Are you sure you want to delete this block?");t&&e.trigger("close").remove()}function f(e,t){var n=null;return function(){var a=this,l=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(a,l)},t)}}var p=!1;jQuery(document).ready(function(){t(),0!==snowball.savedblocks.length&&"null"!==snowball.savedblocks?(snowball.savedblocks=JSON.parse(snowball.savedblocks),n()):snowball.savedblocks=[]})}(jQuery);
//# sourceMappingURL=snowball-admin.min.js.map