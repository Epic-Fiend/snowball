function drawMap(n){var t=t||window.parent.snowball,o=t.pluginsUrl+"/lib/d3-geomap",e=n.find(".json-usa").val(),a=n.find(".map").get(0),l=parseInt(n.find("input.quantize").val()),i=n.find("input.color").val(),r=colorbrewer[i][l],s=n.find(".map-type").val(),c=o+"/topojson/countries/USA.json",d=d3.geo.albersUsa,p=800;if("world"===s&&(e=n.find(".json-world").val(),c=o+"/topojson/world/countries.json",d=d3.geo.equirectangular,p=100),e){n.find(".map").empty();var u=d3.geomap.choropleth().geofile(c).projection(d).column("Value").unitId("fips").scale(p).translate([400,200]).colors(r).legend(!0);d3.select(a).datum(JSON.parse(e)).call(u.draw,u).selectAll("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 500 400")}}!function(n){n(document).ready(function(){var t=n(".snowball-block-choropleth");t.each(function(){drawMap(n(this))})})}(jQuery),function(n){n(document).ready(function(){n("body").on("click",".snowball-block-contact .submit",function(){var t=n(this).closest("form"),o=t.find("[name='to']").val(),e=t.find("[name='subject']").val(),a=t.find("[name='confirmation']").val(),l="",i=t.find("input, textarea").not("[type='hidden']");i.each(function(){var t=n(this).val();l=n(this).attr("name")?l+"\n\n"+n(this).attr("name")+": "+t:l+"\n\n"+t});var r={action:"mail_before_submit",to:o,subject:e,message:l};window.parent&&(snowball=window.parent.snowball),jQuery.post(snowball.adminUrl+"admin-ajax.php",r,function(n){t.text(a)})})})}(jQuery),function(n){n(document).ready(function(){n("body").on("click",".snowball-block-share .button",function(){var n,t=t||window.parent.snowball,o=jQuery(this),e=500,a=400,l=screen.width/2-e/2,i=screen.height/2-a/2,r="toolbar=0,status=0,width="+e+",height="+a+",top="+i+",left="+l;n=o.hasClass("facebook")?"http://www.facebook.com/sharer.php?u="+encodeURIComponent(t.url):o.hasClass("twitter")?"http://twitter.com/share?url="+encodeURIComponent(t.url)+"&text="+encodeURIComponent(t.title):o.hasClass("tumblr")?"https://www.tumblr.com/widgets/share/tool?posttype=link&canonicalUrl="+encodeURIComponent(t.url)+"&title="+encodeURIComponent(t.title)+"&content="+encodeURIComponent(t.excerpt):"https://plus.google.com/share?url="+encodeURIComponent(t.url),window.open(n,"share",r)})})}(jQuery);